(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[936],{4887:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/directories",function(){return t(2273)}])},7644:function(e,r,t){"use strict";t.d(r,{GJ:function(){return a},i4:function(){return s}});var i,s,n=t(9814);async function a(e){if(!e)return!1;try{var r;let t=null===(r=e.user_metadata)||void 0===r?void 0:r.role;if("admin"===t)return!0;try{let{data:r,error:t}=await n.O.from("user_roles").select("role").eq("user_id",e.id).single();if(t){if("42P01"===t.code||"42P17"===t.code){if(console.warn("Database error (".concat(t.code,"): ").concat(t.message)),"68a14571-a988-45a4-b023-0d701ae034f4"===e.id)return console.log("Using hardcoded admin check for initial user"),!0;return!1}return console.error("Error checking admin status:",t),!1}return(null==r?void 0:r.role)==="admin"}catch(e){return console.error("Database error checking admin status:",e),!1}}catch(e){return console.error("Unexpected error checking admin status:",e),!1}}(i=s||(s={})).ADMIN="admin",i.CONTRIBUTOR="contributor",i.VIEWER="viewer"},9814:function(e,r,t){"use strict";t.d(r,{O:function(){return i}});let i=(0,t(6490).eI)("https://mzbodrwzhasiydvpvbid.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16Ym9kcnd6aGFzaXlkdnB2YmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA3MjA0NDAsImV4cCI6MjA1NjI5NjQ0MH0.4PtrUzyD5AUZzWqoWYpgMFlojhW2y9SH6-tPvahPxSo")},2273:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return u}});var i=t(5893),s=t(7294),n=t(1163),a=t(1664),c=t.n(a),d=t(3700),o=t(7644),l=t(9814);function u(){let{user:e}=(0,d.a)(),r=(0,n.useRouter)(),[t,a]=(0,s.useState)(!0),[u,h]=(0,s.useState)(!1),[m,x]=(0,s.useState)([]),[f,p]=(0,s.useState)(null);async function y(){try{let{data:e,error:r}=await l.O.from("directories").select("*").order("created_at",{ascending:!1});if(r)throw r;x(e||[])}catch(e){console.error("Error fetching directories:",e),p(e.message||"Failed to fetch directories")}finally{a(!1)}}async function g(e){if(confirm("Are you sure you want to delete this directory?"))try{let{error:r}=await l.O.from("directories").delete().eq("id",e);if(r)throw r;y()}catch(e){console.error("Error deleting directory:",e),p(e.message||"Failed to delete directory")}}return((0,s.useEffect)(()=>{(async function(){if(!e){r.push("/auth/login");return}try{let t=await (0,o.GJ)(e);h(t),t?y():r.push("/dashboard")}catch(e){console.error("Error checking admin status:",e)}finally{a(!1)}})()},[e,r]),t)?(0,i.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):u?(0,i.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:"Directories"}),(0,i.jsx)(c(),{href:"/admin/create-directory",children:(0,i.jsx)("a",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Create New Directory"})})]}),f&&(0,i.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:(0,i.jsx)("p",{children:f})}),0===m.length?(0,i.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md text-center",children:[(0,i.jsx)("p",{className:"text-gray-600",children:"No directories found."}),(0,i.jsx)("p",{className:"mt-2",children:(0,i.jsx)(c(),{href:"/admin/directories/create",children:(0,i.jsx)("a",{className:"text-blue-600 hover:underline",children:"Create your first directory"})})})]}):(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fields"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,i.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(e=>{var r,t;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,i.jsx)("div",{className:"font-medium text-gray-900",children:e.name})}),(0,i.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(null===(t=e.schema_json)||void 0===t?void 0:null===(r=t.fields)||void 0===r?void 0:r.length)||0," fields"]}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toISOString().split("T")[0]}),(0,i.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,i.jsx)(c(),{href:"/admin/directories/".concat(e.id),children:(0,i.jsx)("a",{className:"text-blue-600 hover:text-blue-900 mr-4",children:"View"})}),(0,i.jsx)("button",{onClick:()=>g(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)})})]})})]}):null}},1163:function(e,r,t){e.exports=t(3079)}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=4887)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{4168:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users",function(){return t(4348)}])},7644:function(e,r,t){"use strict";t.d(r,{GJ:function(){return l},i4:function(){return n}});var s,n,a=t(9814);async function l(e){if(!e)return!1;try{var r;let t=null===(r=e.user_metadata)||void 0===r?void 0:r.role;if("admin"===t)return!0;try{let{data:r,error:t}=await a.O.from("user_roles").select("role").eq("user_id",e.id).single();if(t){if("42P01"===t.code||"42P17"===t.code){if(console.warn("Database error (".concat(t.code,"): ").concat(t.message)),"68a14571-a988-45a4-b023-0d701ae034f4"===e.id)return console.log("Using hardcoded admin check for initial user"),!0;return!1}return console.error("Error checking admin status:",t),!1}return(null==r?void 0:r.role)==="admin"}catch(e){return console.error("Database error checking admin status:",e),!1}}catch(e){return console.error("Unexpected error checking admin status:",e),!1}}(s=n||(n={})).ADMIN="admin",s.CONTRIBUTOR="contributor",s.VIEWER="viewer"},9814:function(e,r,t){"use strict";t.d(r,{O:function(){return s}});let s=(0,t(6490).eI)("https://mzbodrwzhasiydvpvbid.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16Ym9kcnd6aGFzaXlkdnB2YmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA3MjA0NDAsImV4cCI6MjA1NjI5NjQ0MH0.4PtrUzyD5AUZzWqoWYpgMFlojhW2y9SH6-tPvahPxSo")},4348:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return o}});var s=t(5893),n=t(7294),a=t(1163),l=t(3700),i=t(7644),c=t(5450);function d(){let[e,r]=(0,n.useState)([]),[t,a]=(0,n.useState)(!0),[l,d]=(0,n.useState)(null),[o,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(i.i4.VIEWER),[x,p]=(0,n.useState)(!1),[f,b]=(0,n.useState)(null);(0,n.useEffect)(()=>{g()},[]);let g=async()=>{a(!0),d(null);try{let e=await fetch("/api/admin/users/roles");if(!e.ok){let r=await e.json();throw Error(r.error||"Failed to fetch users")}let t=await e.json();r(t)}catch(e){d(e.message||"An error occurred while fetching users")}finally{a(!1)}},j=async()=>{if(o){p(!0),d(null),b(null);try{let e=await fetch("/api/admin/users/roles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o,role:m})});if(!e.ok){let r=await e.json();throw Error(r.error||"Failed to update user role")}r(e=>e.map(e=>e.id===o?{...e,role:m}:e)),b("User role updated successfully to ".concat(m)),u(null),h(i.i4.VIEWER)}catch(e){d(e.message||"An error occurred while updating user role")}finally{p(!1)}}};return t?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Manage User Roles"}),l&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:(0,s.jsx)("p",{children:l})}),f&&(0,s.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:(0,s.jsx)("p",{children:f})}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Update User Role"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"user",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select User"}),(0,s.jsxs)("select",{id:"user",value:o||"",onChange:e=>u(e.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"-- Select a user --"}),e.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.email," (Current: ",e.role,")"]},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Role"}),(0,s.jsx)("select",{id:"role",value:m,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.values(i.i4).map(e=>(0,s.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsx)("button",{onClick:j,disabled:!o||x,className:"px-4 py-2 rounded-md ".concat(o&&!x?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:x?"Updating...":"Update Role"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Users"}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created At"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.email}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.role===i.i4.ADMIN?"bg-purple-100 text-purple-800":e.role===i.i4.CONTRIBUTOR?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.role})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,c.p6)(e.createdAt)})]},e.id))})]})})]})]})}function o(){let{user:e}=(0,l.a)(),r=(0,a.useRouter)(),[t,c]=(0,n.useState)(!0),[o,u]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{(async function(){if(!e){r.push("/auth/login");return}try{let t=await (0,i.GJ)(e);u(t),t||r.push("/dashboard")}catch(e){console.error("Error checking admin status:",e)}finally{c(!1)}})()},[e,r]),t)?(0,s.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):o?(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"User Management"}),(0,s.jsx)(d,{})]}):null}},5450:function(e,r,t){"use strict";function s(e){return e?("string"==typeof e?new Date(e):e).toISOString().split("T")[0]:""}t.d(r,{p6:function(){return s}})},1163:function(e,r,t){e.exports=t(3079)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4168)}),_N_E=e.O()}]);